suite: ConfigMap
templates:
  - templates/configmap.yaml
values:
  - ../ci/default-values.yaml
tests:
  - it: should create a ConfigMap
    asserts:
      - isKind:
          of: ConfigMap

  - it: should contain config.yml key
    asserts:
      - isNotNull:
          path: data["config.yml"]

  - it: should render gitlab url from values
    asserts:
      - matchRegex:
          path: data["config.yml"]
          pattern: "url:.*https://gitlab\\.example\\.com"

  - it: should not contain default gitlab.com url when custom url is set
    asserts:
      - notMatchRegex:
          path: data["config.yml"]
          pattern: "url:.*https://gitlab\\.com"
