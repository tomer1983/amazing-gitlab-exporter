suite: Secret
templates:
  - templates/secret.yaml
values:
  - ../ci/default-values.yaml
tests:
  - it: should create a Secret when no existing secret specified
    asserts:
      - isKind:
          of: Secret
      - equal:
          path: type
          value: Opaque

  - it: should contain gitlab-token
    asserts:
      - isNotNull:
          path: data.gitlab-token

  - it: should not create Secret when existingSecret is set
    set:
      existingSecret.name: my-existing-secret
    asserts:
      - hasDocuments:
          count: 0

  - it: should include webhook-secret when set
    set:
      webhookSecretToken: "my-webhook-secret"
    asserts:
      - isNotNull:
          path: data.webhook-secret

  - it: should include redis-url when set
    set:
      redis.enabled: false
      externalRedis.url: "redis://custom:6379"
    asserts:
      - isNotNull:
          path: data.redis-url
